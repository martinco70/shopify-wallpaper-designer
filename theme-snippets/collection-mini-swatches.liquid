{%- comment -%}
Mini-Swatches für Kollektionsseiten (Option A)
- Zeigt bis zu 4 Geschwister (weitere Farben) unter dem Produktbild
- Wenn mehr als 4 vorhanden, im 4. Kachel ein "+X" Overlay
- Lädt asynchron nach Seitenaufbau; gruppenweite Deduplizierung
Voraussetzung: Produkt-Metafeld custom.designname (Text) ist gesetzt
{%- endcomment -%}

{%- assign ns = 'custom' -%}
{%- assign key = 'designname' -%}
{%- assign group_code = '' -%}
{%- if product.metafields[ns] and product.metafields[ns][key] -%}
  {%- assign group_raw = product.metafields[ns][key] -%}
  {%- assign group_code = group_raw.value | default: group_raw -%}
{%- endif -%}


{%- comment -%} Hover-bezogene Fallbacks und Assets wurden zurückgebaut. {%- endcomment -%}


<div class="wpd-mini-swatches"
     data-group="{{ group_code | escape }}"
     data-handle="{{ product.handle }}"
  data-vendor="{{ product.vendor | escape }}"
     data-shop="{{ shop.permanent_domain }}"
     data-proxy-url="https://app.wirzapp.ch/api/siblings"
     aria-hidden="true"></div>

{%- comment -%} Skript wird mehrfach inkludiert, guard im JS verhindert doppelte Initialisierung {%- endcomment -%}
<script>window.__WPD_DISABLE_MIN25 = true;</script>
<script src="{{ 'wpd-collection-swatches.js' | asset_url }}?v=2025-10-23-08" defer></script>
